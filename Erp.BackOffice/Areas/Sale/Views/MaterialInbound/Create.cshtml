@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using Erp.BackOffice.Sale.Models
@using Erp.BackOffice.Areas.Cms.Models

@model MaterialInboundViewModel

@{
    ViewBag.Title = Wording.PageCreate_MaterialInBound;

    Layout = "~/Views/Shared/ACE_AdminLayout.cshtml";
    Erp.BackOffice.Models.PageSetting pageSetting = new Erp.BackOffice.Models.PageSetting
    {
        ModuleName = "MaterialInBound",
        ActionName = "Create",
        PageTitle = ViewBag.Title,
        DisplaySearchPanel = false,
        IsPopup = false,
        DisplayBackButton = true
    };
    IEnumerable<SelectListItem> warehouseList = Erp.BackOffice.Helpers.SelectListHelper.GetSelectList_Warehouse(null, Wording.Empty);
    IEnumerable<SelectListItem> supplierList = Erp.BackOffice.Helpers.SelectListHelper.GetSelectList_Supplier(null, Wording.Empty);
    IEnumerable<CategoryViewModel> categoryList = (IEnumerable<CategoryViewModel>)ViewBag.categoryList;
    //IEnumerable<WarehouseViewModel> warehouseList = (IEnumerable<WarehouseViewModel>)ViewBag.warehouseList;
}

@section HeadOfPage {
    @Html.ScriptTop_ChosenStyle()
    <link href="/assets/css/combojax.css" rel="stylesheet" />
    <style>
        .has_error {
            border: 1px #f2a696 solid !important;
            color: #D68273;
        }

        .box {
            padding-top: 0px !important;
            padding-bottom: 0px !important;
            margin-top: 0px !important;
        }

        .popover {
            width: 100% !important;
        }

        .itemdiv > .body > .text {
            padding-bottom: 0px !important;
            /* padding-left: 7px; */
            /* font-size: 13px; */
        }

        .itemdiv {
            padding-right: 3px;
            min-height: 42px;
        }

            .itemdiv > .body > .name {
                color: black;
            }

        #popup_archive2 {
            position: center;
            bottom: 30%;
            left: 20%;
            width: 60%;
            height: 535px;
            max-width: 500px;
            /*top: 30%;*/
            right: 30%;
            /*max-height: 100%;*/
            /* overflow-y:scroll;*/
        }

        #chitiet {
            position: relative;
            /* bottom: 50%; */
            left: 80%;
            /* right: 0%; */
            top: auto;
            margin-bottom: 10px;
        }

        #TongSoLuong, ProductItemCount {
            /*width: 3%;
            height: 1.8%;
            text-align: center;
            border-radius: 100px;
            color: #ffc107;
            background: none !important;
            font-weight: bold;

            font-size: 14px;
            padding: unset;
            margin: unset;
            top: 9%;*/
            width: 5%;
            height: 3.8%;
            text-align: right;
            border-radius: 100px;
            color: #ffc107;
            background: none !important;
            font-weight: bold;
            font-size: 23px;
            padding: unset;
            margin: unset;
            margin-left: 10px;
            top: 15%;
            z-index: 5;
        }

        #TongSoLuong, ProductItemCount {
            background: none;
            border: none;
        }

        #TongSoLuong, ProductItemCount {
            /*left: 5.7%;*/
            left: 20.7%;
        }

        form .table-responsive {
            overflow: auto !important;
        }

        #mauexcel {
            border-radius: 5px;
            padding: 15px 60px;
            top: 30%;
            position: relative;
            left: 30%;
            font-size: 16px;
        }

        #scrolltable {
            margin-top: 20px;
            height: 300px;
            overflow: auto;
        }

            #scrolltable table {
                border-collapse: collapse;
            }

            #scrolltable tr:nth-child(even) {
                background: #EEE;
            }

            #scrolltable th div {
                position: absolute;
                margin-top: -20px;
            }

        #exceltable {
            width: 100%;
            overflow-y: scroll !important;
            max-height: 300px !important;
        }
    </style>
}

@using (Html.BeginPageHeaderContainer(pageSetting))
{

}

@using (Html.BeginForm_AceStyle((string)ViewBag.Title, "Create", "MaterialInBound", null, FormMethod.Post, new { id = "CreateMaterialInBound", @class = "form-horizontal clearfix" }))
{
    @Html.ValidationSummary(true)

    <div class="row">
        <div class="col-sm-7">
            <div class="product-search-box clearfix " style="margin-bottom:10px">
                <span class="label label-warning" style="padding: 6px; float: left; height: 26px;margin-left:0px">[F4]</span>
                <div id="product_search_control">
                    <span class="ctl">
                        @Html.TextBox("Material", "", new { placeholder = "Vật tư...", autocomplete = "off", style = "width:300px; margin-right:0px" })
                    </span>
                </div>
            </div>
            <div id="listOrderDetail" class="table-responsive top-10">
                <a class="btn btn-primary btn-mini btn-sm" data-toggle="collapse" data-target="#popup_archive2" id="chitiet" style="border-radius:5px;">
                    <i class="ace-icon fa fa-cloud-upload"></i>
                    Nhập excel
                </a>

                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th style="width:5%">STT</th>
                            <th>Tên vật tư</th>
                            <th class="detail_locode">Lô/Hạn SD</th>
                            <th style="width:10%">Số lượng</th>
                            <th style="width:15%">Đơn giá</th>
                            <th style="width:15%">Thành tiền</th>
                            <th style="width:50px;"></th>
                        </tr>
                    </thead>
                    <tbody class="detailList">
                        <tr role="0" hidden>
                            <td class="text-center">
                                1
                            </td>
                            <td>
                                <input class="item_id" type="hidden" id="DetailList_0__Id" name="DetailList[0].Id" value="0" />
                                <input class="item_material_id" type="hidden" id="DetailList_0__MaterialId" name="DetailList[0].MaterialId" value="0" />
                                <span class="item_material_name"></span>
                            </td>
                            <td class="detail_locode">
                                <input class="item_locode valid_null" type="text" id="DetailList_0__LoCode" name="DetailList[0].LoCode" value="" style="width:80px" />
                                <input class="input-mask-date item_expiry_date valid_null" type="text" id="DetailList_0__ExpiryDate" name="DetailList[0].ExpiryDate" value="" style="width:80px;">
                            </td>
                            <td>
                                <input type="hidden" name="DetailList[0].Unit" id="DetailList_0__Unit" value="" class="item_unit" />
                                <input class="item_quantity numberinput2 text-right" type="text" id="DetailList_0__Quantity" name="DetailList[0].Quantity" value="0" style="width:100%" />
                            </td>
                            <td>
                                <input class="item_price numberinput2 text-right" type="text" id="DetailList_0__Price" name="DetailList[0].Price" value="" style="width:100%" />
                            </td>
                            <td align="right"><span class="item_total" align="right"></span></td>
                            <td class="text-center">
                                <a class="btn-delete-item">
                                    <i class="ace-icon fa fa-trash red bigger-120" style="cursor:pointer"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>
                                <input style="width:30px;" autocomplete="off" data-val="true" data-val-number="The field Sản phẩm đã chọn must be a number." data-val-required="Bắt buộc nhập" id="ProductItemCount" maskformat="" name="ProductItemCount" placeholder="" type="text" value="" readonly="readonly" />
                            </td>
                            <td class="detail_locode"></td>
                            <td></td>
                            <td id="TongSoLuong" align="right" style="font-weight:bold"></td>
                            <td></td>
                            <td id="TongThanhTien" align="right" style="font-weight:bold"></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
                <span style="color:red" class="field-validation-valid help-inline" data-valmsg-for="ProductItemCount" data-valmsg-replace="true"></span>
            </div>
        </div>
        <div class="col-sm-5">
            <div class="tabbable">
                <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="tabCustomer">
                    <li class="active">
                        <a data-toggle="tab" href="#tab1">Phiếu nhập kho</a>
                    </li>

                </ul>

                <div class="tab-content">
                    <div id="tab1" class="tab-pane in active">
                        @*@Html.CustomDropDownListFor(model => model.WarehouseDestinationId, warehouseList, WidthType.span12, true)*@
                        <p>
                            <label class="control-label">Kho nhận</label>
                            <select id="WarehouseDestinationId" name="WarehouseDestinationId" class="form-control ">
                                @foreach (var item in categoryList)
                                {
                                    <option value="@item.Id" title="@item.CategoryValue">
                                        @item.Code - @item.Name (@item.BranchName)
                                    </option>
                                }
                            </select>
                        <p id="demo" hidden></p>
                        </p>
                        @Html.CustomDropDownListFor(model => model.SupplierId, supplierList, WidthType.span12, true, "- chọn -")
                        @Html.CustomTextAreaFor(model => model.Note, null, WidthType.span12)
                    </div>

                </div>
            </div>

            <div class="widget-box top-10" id="widget-box-1">
                <div class="widget-header">
                    <h5 class="widget-title">Thanh toán</h5>
                </div>
                <div class="widget-body">
                    <div class="widget-main">
                        @Html.CustomTextboxFor(model => model.TotalAmount, null, null, WidthType.span12, true, new Dictionary<string, object> { { "class", "col-sm-12 numberinput2" }, { "readonly", "readonly" } })
                    </div>
                </div>

                <div class="downloadFIle" style="padding-top:10px; height:30%">
                    <a class="btn btn-white btn-success btn-sm" id="mauexcel" href="@Url.Action("PrintExample","MaterialInbound")">
                        <i class="fa fa-cloud-download fa-1x" aria-hidden="true"></i>
                        Tải file mẫu
                    </a>
                </div>
            </div>
        </div>
    </div>

    @*Begin import excel*@
    <div class="mini-popup">
        <div id="popup_archive2" class="popover fade top">
            <h3 class="popover-title"><i class="ace-icon fa fa-arrow-circle-right"></i> Import excel</h3>
            <div class="popover-content">
                <div class="row-1">
                    <div class="col-sm-12">
                        <label for="excelfile">Chọn File Excel</label>
                        <input type="file" id="excelfile" style="border-radius:5px;" accept=".xls,.xlsx" />
                        <input type="button" id="viewfile" value="Xem trước" style="border-radius:5px;" />
                        <br />
                        <br />
                        <div id="scrolltable">
                            <table id="exceltable" class="table table-bordered" style="border-radius:5px;">
                                @*<thead>
                                        <tr>
                                            <th style="width:5%">STT</th>
                                            <th style="width:20%">Mã Sản Phẩm</th>
                                            <th style="width:15%">Số lượng</th>
                                            <th style="width:15%">Đơn Giá</th>
                                        </tr>
                                    </thead>*@
                            </table>
                        </div>
                        <p class="top-10">
                            <input class="btn btn-white btn-success btn-sm hideinput" data-toggle="collapse" data-target="#popup_archive2" id="addproduct" value="Import" name="Save" type="button" style="border-radius:5px;" />
                            <a class="btn btn-white btn-sm no-border" data-toggle="collapse" id="closepopup" data-target="#popup_archive2" style="border-radius:5px;margin-top:5px">Đóng</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*end  import excel*@

    using (Html.BeginButtonContainer(pageSetting))
    {
        <a class="btn btn-mini btn-primary" id="Save" name="Save" value="Save">
            <i class="ace-icon fa fa-save"></i>

            @Wording.Save
        </a>
    }
}

@section Scripts {

    @Html.ScriptBottom_ValidationMvc()
    @Html.ScriptBottom_ChosenStyle()
    @Html.ScriptBottom_DatePicker("dd/MM/yyyy")

    <script src="/Scripts/combojax.js?=vs1.011"></script>
    <link href="/Scripts/RadCombobox_v1/RadComboBoxLite.css" rel="stylesheet" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/xlsx.full.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.5/jszip.js"></script>

    <script type="text/javascript">
            $(window).keydown(function (e) {
                if (e.which == 115) {   // khi nhấn F4 trên bàn phím hiển thị dữ liệu dropdownlist
                    e.preventDefault();
                    $("#Material").focus();
                }
            });
        

        $(document).ready(function () {
            LoadNumberInput();
            $('#listOrderDetail').on('change', 'input', function () {
                var value = $(this).val();
                if (value == "") {
                    $(this).addClass("valid_null");
                }
                else {
                    $(this).removeClass("valid_null");
                    $(this).removeClass("has_error");

                }
            });
            //if ($('#combojax_Material').length > 0) {
            $("#combojax_Material .item").click(function () {
                if ($('#listOrderDetail .detailList #DetailList_1__MaterialId').value()) {

                }
            });
            //}
            $('#Save').click(function () {
                //  debugger
                // var a = $("#listOrderDetail .detailList #DetailList_0__MaterialId");
                var b = $('#listOrderDetail .detailList #DetailList_1__MaterialId').val();
                //  var c = $("#DetailList").val();
                //  var d = "awdaw";
                if (b > 0 || b != null) {

                    //ShowLoading();
                    // parseValidatorForm("#CreateProductInBound");
                    var WarehouseDestinationId = $("#WarehouseDestinationId").val();
                    var SupplierId = $("#SupplierId option:selected").val();
                    var messagge = "";
                    var count_locode = null;
                    var expiry_date_null = null;
                    $('.valid_null').addClass("has_error");
                    //if (count_locode > 1) {
                    //    messagge += "Cần nhập đầy đủ số lô <br>";
                    //}
                    //if (expiry_date_null > 1) {
                    //    messagge += "Cần nhập đầy đủ hạn sử dụng <br>";
                    //}
                    if ($('#demo').text() != 'VT') {
                        if (count_locode > 0) {
                            messagge += "Cần nhập đầy đủ số lô <br>";
                        }
                        if (expiry_date_null > 0) {
                            messagge += "Cần nhập đầy đủ hạn sử dụng <br>";
                        }
                    }
                    if (WarehouseDestinationId == '') {
                        messagge += "Kho nhận chưa có <br>";
                    }
                    //if (SupplierId == '') {
                    //    messagge += "Nhà cung cấp chưa có <br>";
                    //}
                    if (messagge != '') {
                        alertPopup('Lỗi!', messagge, 'error');
                        HideLoading();
                    }
                    else {
                        ClearFormatBeforeSubmit($("#CreateMaterialInBound"));
                        $("#CreateMaterialInBound").submit();
                        // HideLoading();
                    }
                }


                //return false;
            });

            $.mask.definitions['~'] = '[+-]';
            $('.input-mask-date').mask('99/99/9999');
            calcTotalAmount();
            $('#ProductItemCount').val($('#listOrderDetail .detailList tr').length - 1);


        });
        $(function () {
            $('#WarehouseDestinationId').change(function () {
                var selectedEventType = this.options[this.selectedIndex].title;
                document.getElementById("demo").innerHTML = selectedEventType;
                if (selectedEventType == "VT") {
                    $('.detail_locode').hide();
                } else {
                    $('.detail_locode').show();
                }
            });
        });
    </script>

    @*begin js import excel*@
    <script type="text/javascript">
        $("body").on("click", "#viewfile", function () {
            var fileUpload = $("#excelfile")[0];
            debugger
            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
            if (regex.test(fileUpload.value.toLowerCase())) {
                if (typeof (FileReader) != "undefined") {
                    var reader = new FileReader();

                    //For Browsers other than IE.
                    if (reader.readAsBinaryString) {
                        reader.onload = function (e) {
                            ProcessExcel(e.target.result);
                        };
                        reader.readAsBinaryString(fileUpload.files[0]);
                    } else {
                        //For IE Browser.
                        reader.onload = function (e) {
                            var data = "";
                            var bytes = new Uint8Array(e.target.result);
                            for (var i = 0; i < bytes.byteLength; i++) {
                                data += String.fromCharCode(bytes[i]);
                            }
                            ProcessExcel(data);
                        };
                        reader.readAsArrayBuffer(fileUpload.files[0]);
                    }
                } else {
                    alert("This browser does not support HTML5.");
                }
            } else {
                alert("Please upload a valid Excel file.");
            }
        });
        function ProcessExcel(data) {
            //Read the Excel File data.
            var workbook = XLSX.read(data, {
                type: 'binary'
            });

            //Fetch the name of First Sheet.
            var firstSheet = workbook.SheetNames[0];

            //Read all rows from First Sheet into an JSON array.
            var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);

            //Create a HTML Table element.
            var table = $("<table/>");
            table[0].border = "1";
            table[0].id = "exceltable";
            table[0].addClass = "table table-bordered";

            //Add the header row.
            var row = $(table[0].insertRow(-1));

            //Add the header cells.
            var headerCell = $("<th/>");
            headerCell.html("STT");
            headerCell.css("width", "20%");
            row.append(headerCell);

            var headerCell = $("<th/>");
            headerCell.html("MaSanPham");
            row.append(headerCell);

            var headerCell = $("<th/>");
            headerCell.html("SoLuong");
            row.append(headerCell);

            var headerCell = $("<th/>");
            headerCell.html("DonGia");
            row.append(headerCell);
            //Add the data rows from Excel file.
            for (var i = 0; i < excelRows.length; i++) {
                debugger
                //Add the data row.
                var row = $(table[0].insertRow(-1));

                //Add the data cells.
                var cell = $("<td/> ");
                cell.html(excelRows[i].STT);
                cell.css("width", "20%");
                row.append(cell);

                cell = $("<td/> ");
                cell.html(excelRows[i].MaSanPham);
                cell.css("width", "40%");
                row.append(cell);

                cell = $("<td/> ");
                cell.html(excelRows[i].SoLuong);
                cell.css("width", "20%");
                cell.css("text-align", "center");
                row.append(cell);

                cell = $("<td/>");
                cell.html(excelRows[i].DonGia);
                cell.css("width", "20%");
                cell.css("text-align", "center");
                row.append(cell);
            }

            var dvExcel = $("#scrolltable");
            dvExcel.html("");
            dvExcel.append(table);
        };
    </script>
    <script type="text/javascript">
        function BindTable(jsondata, tableid) {/*Function used to convert the JSON array to Html Table*/
            var columns = BindTableHeader(jsondata, tableid); /*Gets all the column headings of Excel*/
            for (var i = 0; i < jsondata.length; i++) {
                var row$ = $('<tr/>');
                for (var colIndex = 0; colIndex < columns.length; colIndex++) {
                    var cellValue = jsondata[i][columns[colIndex]];
                    if (cellValue == null)
                        cellValue = "";
                    row$.append($('<td/>').html(cellValue));
                }
                $(tableid).append(row$);
            }
        }
        function BindTableHeader(jsondata, tableid) {/*Function used to get all column names from JSON and bind the html table header*/
            var columnSet = [];
            var headerTr$ = $('<tr/>');
            for (var i = 0; i < jsondata.length; i++) {
                var rowHash = jsondata[i];
                for (var key in rowHash) {
                    if (rowHash.hasOwnProperty(key)) {
                        if ($.inArray(key, columnSet) == -1) {/*Adding each unique column names to a variable array*/
                            columnSet.push(key);
                            headerTr$.append($('<th/>').html(key));
                        }
                    }
                }
            }
            $(tableid).append(headerTr$);
            return columnSet;
        }

        $("body").on("click", "#addproduct", function (e) {
            //var a = $('.detailList').find("tr:eq(0)").find("td:eq(1)").html();
            ////ShowLoading();

            //if (a == null) {
                e.preventDefault();
                var stt = 0;
                var ListForm = Array();

                var WarehouseId = $("#WarehouseDestinationId").find("option:selected").val();

                document.getElementById("exceltable").deleteRow(0);
                //ShowLoading();
                $("#exceltable TBODY TR").each(function () {
                    var row = $(this);

                    var OrderNo = row.find("TD").eq(0).html();
                    var ProductCode = row.find("TD").eq(1).html();
                    var Quantity = row.find("TD").eq(2).html();
                    var price = row.find("TD").eq(3).html();

                    var formdata = {
                        STT: OrderNo,
                        MaSanPham: ProductCode,
                        SoLuong: Quantity,
                        DonGia: price,
                        WarehouseId: WarehouseId
                    };
                    ListForm.push(formdata);

                    row.remove();
                });
                //ShowLoading();
                $.ajax({
                    type: "POST",
                    url: "/MaterialInBound/ImportExcel",
                    data: JSON.stringify(ListForm),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (r) {
                        //location.reload();
                        //ShowLoading();
                        $(".detailList").html(r);
                        debugger
                        var countItem = $('.detailList tr.detail_item').length;
                        $('#ProductItemCount').val(countItem);
                        calcTotalAmount();

                        var irow = 1;
                        $("#listOrderDetail tbody tr").each(function () {
                            var row = $(this);
                            if (irow == $('.detailList tr.detail_item').length) {
                                $(this).closest('tr').remove();

                                var countItem = $('.detailList tr.detail_item').length;
                                $('#ProductItemCount').val(countItem);

                                if (countItem == 0) {
                                    $('#ProductItemCount').val('');
                                    $('#TongSoLuong').text('');
                                    $('#TongThanhTien').text('');
                                }
                                calcTotalAmount();

                                $('.detailList tr.detail_item').each(function (index, tr) {
                                    debugger
                                    $(tr).attr('role', index);
                                    $(tr).find('td:first-child').text(index);
                                    $(tr).find('.item_material_id').attr('name', 'DetailList[' + index + '].MaterialId').attr('id', 'DetailList_' + index + '__MaterialId');
                                    $(tr).find('.item_id').attr('name', 'DetailList[' + index + '].Id').attr('id', 'DetailList_' + index + '__Id');
                                    $(tr).find('.item_quantity').attr('name', 'DetailList[' + index + '].Quantity').attr('id', 'DetailList_' + index + '__Quantity');
                                    $(tr).find('.item_price').attr('name', 'DetailList[' + index + '].Price').attr('id', 'DetailList_' + index + '__Price');
                                    $(tr).find('.item_locode').attr('name', 'DetailList[' + index + '].LoCode').attr('id', 'DetailList_' + index + '__LoCode');
                                    $(tr).find('.item_expiry_date').attr('name', 'DetailList[' + index + '].ExpiryDate').attr('id', 'DetailList_' + index + '__ExpiryDate');
                                    $(tr).find('.item_unit').attr('name', 'DetailList[' + index + '].Unit').attr('id', 'DetailList_' + index + '__Unit');
                                });
                            }
                            irow = irow + 1;

                        });

                        HideLoading();
                    }
                });

                $('#addproduct').addClass('hideinput');
                $("#exceltable TBODY").remove();
            //}
            //else {
            //    $("#exceltable TBODY TR").each(function () {
            //        var row = $(this);
            //        var OrderNo = row.find("TD").eq(0).html();
            //        var ProductCode = row.find("TD").eq(1).html();
            //        var Quantity = row.find("TD").eq(2).html();
            //        var price = row.find("TD").eq(3).html();
            //        var formdata = {
            //            OrderNo: OrderNo,
            //            ProductId: 0,
            //            Quantity: Quantity,
            //            Price: price,
            //            ProductCode: ProductCode,
            //        };

            //        $("#listOrderDetail1 TBODY TR").each(function () {
            //            debugger
            //            var row = $(this);
            //            var w = $(window);
            //            $(this).removeClass('selected_grey').addClass("text_data");

            //            var ProductCode1 = $(this).closest('tr').find("td:eq(1) input:nth-child(2)").val();

            //            if (String(ProductCode).trim().localeCompare(String(ProductCode1).trim()) == 0) {
            //                $(this).closest('tr').find("td:eq(2) input:nth-child(2)").val(parseInt($(this).closest('tr').find("td:eq(2) input:nth-child(2)").val()) + parseInt(Quantity));
            //                $(this).closest('tr').find("td:eq(2) input:nth-child(2)").trigger('change');
            //                $(this).addClass('selected_grey');
            //                var body = $("html,#listOrderDetail");
            //                body.stop().animate({ scrollTop: row.offset().top - (w.height() / 1.6) }, 500, 'swing', function () {
            //                    row.addClass('scrollCode');
            //                });
            //                formdata = {};
            //                return;
            //            } else {
            //                $(this).removeClass("scrollCode");
            //            }
            //        });
            //        //Thêm dòng mới
            //        ClickEventHandler(true, "/MaterialInbound/LoadMaterialItem", ".detailList", formdata, function () {
            //            $('#ProductItemCount').val($('#listOrderDetail .detailList tr').length);
            //            $.mask.definitions['~'] = '[+-]';
            //            $('.input-mask-date').mask('99/99/9999');
            //            calcAmountItem(formdata.OrderNo);
            //            calcTotalAmount();
            //            $("#DetailList_" + formdata.OrderNo + "_Quantity").focus().select();

            //        });
            //        stt = stt++;
            //        row.remove();
            //    })

            //    $("#exceltable TBODY").remove();
            //    document.getElementById("excelfile").value = "";
            //}

        });
        $('#listOrderDetail').on('change', '.item_price:not(.mask-format-currency)', function () {
            $(this).val($(this).val().replace(/\-/g, ''));
            $(this).val($(this).val().replace(/[^0-9.,]/g, ''));
            var ralVal = numeral($(this).val());
            if (ralVal <= 0) {
                $(this).val(1);
            }
            var $this = $(this);
            var id = $this.closest('tr').attr('role');
            calcAmountItem(id);
            calcTotalAmount();
        });
        $("#closepopup").click(function () {
            $("#exceltable TBODY").remove();
            document.getElementById("excelfile").value = "";
        });
        $("#viewfile").click(function () {
            $("#addproduct").removeClass('hideinput');
        });

    </script>
    @*end js import excel*@


    <script src="/Scripts/area_sale/MaterialInbound.js?=vs1.11"></script>
}
