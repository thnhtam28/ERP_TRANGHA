
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
@using Erp.BackOffice.App_GlobalResources
@using Erp.BackOffice.Helpers
@using System.Globalization;
@{
    ViewBag.Title = "Biểu đồ tương tác";
    Layout = "~/Views/Shared/ACE_AdminLayout.cshtml";
    Erp.BackOffice.Models.PageSetting pageSetting = new Erp.BackOffice.Models.PageSetting
    {
        ModuleName = "Home",
        ActionName = "InteractiveChart",
        PageTitle = ViewBag.Title,
        DisplaySearchPanel = true,
        IsPopup = false,
        DisplayBackButton = false,
        SearchButtonText = "Xem báo cáo"
    };
    DateTime aDateTime = new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1);
    DateTime retDateTime = aDateTime.AddMonths(1).AddDays(-1);
    string branchId = Request["branchId"] != null ? Request["branchId"] : "";
    IEnumerable<Erp.BackOffice.Areas.Administration.Models.UserViewModel> user = (IEnumerable<Erp.BackOffice.Areas.Administration.Models.UserViewModel>)ViewBag.user;
}

@section HeadOfPage {
    <style type="text/css">
        .cell-center {
            text-align: center;
        }

        .tr-bold {
            font-weight: 700;
        }

        .ctl {
            position: relative;
            /*float: left;*/
            margin-right: 3px;
        }

            .ctl .error {
                position: absolute;
                background: #de2a2a;
                left: 0px;
                top: 28px;
                padding: 2px 5px;
                color: #fff;
                z-index: 999;
            }

                .ctl .error:before {
                    border-bottom: 7px solid #de2a2a;
                    border-left: 7px solid transparent;
                    border-right: 7px solid transparent;
                    left: 9px;
                    top: -6px;
                    content: "";
                    display: inline-block;
                    position: absolute;
                }

        .icon-add {
            margin-top: 0px !important;
        }

        .combojax {
            display: inline-block;
            position: initial !important;
            float: none !important;
        }
    </style>

}
<span id="Notification"></span>

<div id="page_header" class="widget-box">
    <div class="widget-header">
        <h5 class="widget-title">
            <i class="ace-icon fa fa-star orange"></i>
            @ViewBag.Title
        </h5>
        <div class="widget-toolbar">
            <a class="btn-search" href="#" data-action="collapse">
                <i class="ace-icon fa fa-search blue"></i>
            </a>
            <a class="btn-setting"></a>
        </div>
    </div>

    <div class="widget-body" style="display: block;">
        <div class="widget-main">
            <div class="search-view form-inline" id="SaleReport">
                @Html.Partial("_PartialSearchDrugStore", ViewData["branchId"]) <p id="d" style="display:none; color:orangered">Bắt buộc nhập</p>
                <p>
                    Xem dữ liệu theo
                    <span class="input-daterange input-group" >
                        @Html.TextBox("StartDate", Request["StartDate"] != null ? Request["StartDate"] :"", new { autocomplete = "off", placeholder = "Từ ngày"})
                        <span class="input-group-addon">
                            <i class="fa fa-exchange"></i>
                        </span>
                        @Html.TextBox("EndDate", Request["EndDate"] != null ? Request["EndDate"] : "", new { autocomplete = "off", placeholder = "Đến ngày"})
                    </span>
                    
                    <select id="NGUOILAP" name="NGUOILAP">
                        <option value="">- Người quản lý -</option>
                        @foreach (var item in user.OrderBy(x => x.FullName))
                        {
                            <option value="@item.Id" data-selected="0">@item.FullName</option>
                        }
                    </select>
                    @Html.DropDownList("HINHTHUC_TUONGTAC", Erp.BackOffice.Helpers.SelectListHelper.GetSelectList_Category("HINHTHUC_GIOITHIEU", Request["HINHTHUC_TUONGTAC"], "-Hình thức-"), new { style = "width: 150px;/* padding-right: 0px; */margin-right: 100px;margin-left:1px;" })
                </p>
                <p style="margin:0px;">
                    <button class="btn btn-mini btn-primary" name="search" onclick="searchreact()" type="submit" value="Search">
                        Xem báo cáo
                    </button>
                </p>
            </div>
        </div>
    </div>
</div>

<style>
    html {
        font-size: 14px;
        font-family: Arial, Helvetica, sans-serif;
    }
</style>
<title></title>
<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2019.1.220/styles/kendo.common.min.css" />
<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2019.1.220/styles/kendo.silver.min.css" />
<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2019.1.220/styles/kendo.silver.mobile.min.css" />

<script src="https://kendo.cdn.telerik.com/2019.1.220/js/jquery.min.js"></script>
<script src="https://kendo.cdn.telerik.com/2019.1.220/js/kendo.all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

<div class="row" style="padding-top: 5px;">
    <div class="col-xs-12">
        <div id="demo">

        </div>
    </div>
</div>
<script>

                          $('.input-daterange').datepicker({format:'dd/mm/yyyy'}).on('changeDate', function (e) {

                          });
</script>  

@section Scripts {
    @Html.ScriptBottom_ValidationMvc()

    <script src="/Scripts/combojax.js"></script>
    <link href="/assets/css/combojax.css" rel="stylesheet" />
    <script>


    //function ClosePopupPrint() {
    //    ClosePopup(false);
    //}
    //searchreact();
        function searchreact() {
            debugger
       //document.getElementById("#branchId").focus();
            var branchId = $("#branchId option:selected").val();
            var NGUOILAP = $('#NGUOILAP').val();
            var HINHTHUC_TUONGTAC = $('#HINHTHUC_TUONGTAC option:selected').val();
            var start = $('#StartDate').val();
            var end = $('#EndDate').val();
            if (branchId == '') {
                $("#branchId").focus().select();
                $('[data-rel=tooltip]').tooltip({ container: 'body' });
                $("#Notification").kendoNotification({
                    position: {
                        top: 50
                    }
                });
                $("#Notification").getKendoNotification().show("Chi nhánh không được bỏ trống !", "error");
            } else {
                if (NGUOILAP == '') {
                    $("#NGUOILAP").focus().select();
                    $('[data-rel=tooltip]').tooltip({ container: 'body' });
                    $("#Notification").kendoNotification({
                        position: {
                            top: 50
                        }
                    });
                    $("#Notification").getKendoNotification().show("Người quản lý không được bỏ trống !", "error");
                } else {
                    if (HINHTHUC_TUONGTAC == '') {
                        $("#HINHTHUC_TUONGTAC").focus().select();
                        $('[data-rel=tooltip]').tooltip({ container: 'body' });
                        $("#Notification").kendoNotification({
                            position: {
                                top: 50
                            }
                        });
                        $("#Notification").getKendoNotification().show("Hình thức không được bỏ trống !", "error");
                    } else {
                        if (start == '' || end == '') {
                            $("#Notification").kendoNotification({
                                position: {
                                    top: 50
                                }
                            });
                            $("#Notification").getKendoNotification().show("Vui lòng chọn thời gian !", "error");
                        }
                    }
                }
            }



        GetDatatable('/Home/_GetList_InteractiveChart', '@Html.Raw(ViewBag.Title)');
    };
        function GetDatatable(url, title) {
            var StartDate = $("#StartDate").val();
            var EndDate = $("#EndDate").val();
            var CityId = $("#CityId option:selected").val();
            var DistrictId = $("#DistrictId option:selected").val();
            var branchId = $("#branchId option:selected").val();
            var NGUOILAP = $('#NGUOILAP').val();
            var HINHTHUC_TUONGTAC = $('#HINHTHUC_TUONGTAC option:selected').val();
            var formdata = {
                StartDate: StartDate,
                EndDate: EndDate,
                CityId: CityId,
                DistrictId: DistrictId,
                branchId: branchId,
                NGUOILAP: NGUOILAP,
                HINHTHUC_TUONGTAC: HINHTHUC_TUONGTAC
            };




        $("#react_report").html("");
        ClickEventHandlerHTML(true, url, "#demo", formdata, function () {
        });
    };
        
    </script>
}
    @Html.ScriptBottom_DatePicker("dd/MM/yyyy")